import{r as s,e,j as l,o as a,Y as i,d as n,Z as t,_ as r,L as c,b as o,y as d,P as h}from"./index-epAGByur.js";import"./vendor-MJHYApCa.js";const m="/assets/0b0266aa3f750eb120b72745ffa104b7-CtykIY60.jpg";function u(){const[u,x]=s.useState([]),[j,v]=s.useState(!0),[p,N]=s.useState(null),[g,f]=s.useState(""),[k,b]=s.useState(!1),[y,I]=s.useState(1),[C,S]=s.useState(!0),[w,E]=s.useState(!1),[U,M]=s.useState(!1),[A,G]=s.useState({level:"",country:"",skills:""}),[_,z]=s.useState({totalUsers:0,onlineUsers:0,newUsers:0,topSkills:[]}),q=localStorage.getItem("userId"),B=s.useRef();B.current={hasMore:C,loadingMore:w,page:y},s.useEffect((()=>{B.current={hasMore:C,loadingMore:w,page:y}}),[C,w,y]);const L=s.useCallback((async(s,l="")=>{try{v(!0);const a=localStorage.getItem("token"),i={page:s,limit:5};l&&(i.query=l),A.level&&(i.level=A.level),A.country&&(i.country=A.country),A.skills&&(i.skills=A.skills);const n=await e.get("https://padel-hnj9.onrender.com/api/users",{headers:{Authorization:`Bearer ${a}`},params:i}),t=n.data.users;if(x(1===s?t:s=>{const e=s.map((s=>s._id)),l=t.filter((s=>!e.includes(s._id)));return[...s,...l]}),S(n.data.hasMore),b(0===t.length),1===s){const s=await e.get("https://padel-hnj9.onrender.com/api/users/stats",{headers:{Authorization:`Bearer ${a}`}});z({totalUsers:s.data.totalUsers,onlineUsers:s.data.onlineUsers,newUsers:s.data.newUsers,topSkills:s.data.topSkills})}}catch(a){N("فشل تحميل المستخدمين")}finally{v(!1),E(!1)}}),[A]);s.useEffect((()=>{L(1,g)}),[g,L]),s.useEffect((()=>{const s=()=>{const{scrollTop:s,clientHeight:e,scrollHeight:l}=document.documentElement,{hasMore:a,loadingMore:i,page:n}=B.current;if(s+e>=l-5&&!i&&a){E(!0);const s=n+1;L(s,g).finally((()=>{I(s)}))}};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)}),[L,g]);const $=()=>{g.trim().length<1||(I(1),L(1,g))},H=s=>{const{name:e,value:l}=s.target;G((s=>({...s,[e]:l})))},P=()=>{G({level:"",country:"",skills:""}),I(1),M(!1),L(1,g)};return l.jsxs("div",{className:"users-list",children:[l.jsx(a,{}),l.jsxs("div",{className:"users-list-container-home",children:[l.jsxs("div",{className:"users-list-header-home",children:[l.jsxs("div",{className:"header-content-home",children:[l.jsxs("div",{className:"stats-section-home",children:[l.jsxs("div",{className:"stats-card-home",children:[l.jsx("div",{className:"stats-icon-home",children:l.jsx(i,{})}),l.jsxs("div",{className:"stats-info-home",children:[l.jsx("span",{className:"stats-value-home",children:_.totalUsers}),l.jsx("span",{className:"stats-label-home",children:"المستخدمين"})]})]}),l.jsxs("div",{className:"stats-card-home",children:[l.jsx("div",{className:"stats-icon-home new",children:l.jsx(n,{})}),l.jsxs("div",{className:"stats-info-home",children:[l.jsx("span",{className:"stats-value-home",children:_.newUsers}),l.jsx("span",{className:"stats-label-home",children:"جدد هذا الشهر"})]})]})]}),l.jsxs("div",{className:"search-section-users",children:[l.jsxs("div",{className:"search-container-users",children:[l.jsx("input",{type:"text",placeholder:"البحث حسب الاسم او الخبرة او المهارات...",value:g,onChange:s=>f(s.target.value),onKeyDown:s=>"Enter"===s.key&&$()}),l.jsx("button",{className:"search-button-home",onClick:$,children:l.jsx(t,{})}),l.jsx("button",{className:"filter-button-home",onClick:()=>M(!U),children:l.jsx(r,{})})]}),U&&l.jsxs("div",{className:"filters-panel-home",children:[l.jsxs("div",{className:"filter-group-home",children:[l.jsx("label",{children:"المستوى:"}),l.jsxs("select",{name:"level",value:A.level,onChange:H,children:[l.jsx("option",{value:"",children:"الكل"}),l.jsx("option",{value:"Beginner",children:"مبتدئ"}),l.jsx("option",{value:"Intermediate",children:"متوسط"}),l.jsx("option",{value:"Advanced",children:"متقدم"}),l.jsx("option",{value:"Expert",children:"خبير"})]})]}),l.jsxs("div",{className:"filter-group-home",children:[l.jsx("label",{children:"الدولة:"}),l.jsx("input",{type:"text",name:"country",placeholder:"مثال: مصر",value:A.country,onChange:H})]}),l.jsxs("div",{className:"filter-group-home",children:[l.jsx("label",{children:"المهارات:"}),l.jsx("input",{type:"text",name:"skills",placeholder:"مثال: React, تصميم",value:A.skills,onChange:H})]}),l.jsxs("div",{className:"filter-buttons-home",children:[l.jsx("button",{className:"apply-btn-home",onClick:()=>{I(1),M(!1),L(1,g)},children:"تطبيق"}),l.jsx("button",{className:"reset-btn-home",onClick:P,children:"إعادة تعيين"})]})]})]})]}),l.jsxs("div",{className:"skills-section-user-list-home",children:[l.jsx("h3",{children:"أكثر المهارات طلباً:"}),l.jsx("div",{className:"skills-list-user-list-home",children:_.topSkills.slice(0,10).map(((s,e)=>l.jsx("div",{className:"skill-tag-user-list-home",children:s.skill||"مهارة"},e)))})]})]}),l.jsxs("div",{className:"users-content-user-list-hoem",children:[l.jsx("div",{className:"friend-requests-section-home",children:l.jsxs(c,{to:"/@!friend-requests",className:"friend-requests-link-home",children:[l.jsx(n,{})," طلبات الصداقة"]})}),k&&l.jsxs("div",{className:"no-results-user-list-home",children:[l.jsx("img",{loading:"lazy",src:"https://cdn-icons-png.flaticon.com/512/7486/7486744.png",alt:"No results"}),l.jsxs("p",{children:['لا يوجد نتائج ل "',g,'"']}),l.jsx("button",{onClick:P,children:"إعادة تعيين الفلاتر"})]}),l.jsx("div",{className:"users-containers-user-list-home",children:u.map((s=>{var e,a,n,t,r,u,x;return l.jsxs("div",{className:"user-cards-user-lsit-home",children:[l.jsxs("div",{className:"cover-images-user-list-home",children:[l.jsx("img",{src:s.coverImage?s.coverImage:m,loading:"lazy",alt:"Cover"}),l.jsxs("div",{className:"profile-image-container-user-list-home",children:[l.jsx("img",{src:s.profileImage?s.profileImage:m,loading:"lazy",alt:"Profile",onError:s=>((s,e)=>{s.target.src=e})(s,h)}),s.isOnline&&l.jsx("div",{className:"online-badge"})]})]}),l.jsxs("div",{className:"user-infos-user-list-home",children:[l.jsxs(c,{to:q===s._id?"/@!profile":`/@!users/${s._id}`,className:"user-name-user-list-home",children:[s.name,l.jsx("span",{className:"underline-user-list-home"})]}),l.jsxs("div",{className:"badges-user-list",children:[l.jsx("div",{className:`badge-user-list-level ${null==(e=s.level)?void 0:e.toLowerCase()}`,children:s.level&&(x=s.level,{Beginner:"مبتدئ",Intermediate:"متوسط",Advanced:"متقدم",Expert:"خبير"}[x]||x)}),(null==(a=s.personalInfo)?void 0:a.country)&&l.jsxs("div",{className:"badge-user-list-country",children:[l.jsx(i,{})," ",s.personalInfo.country]})]}),l.jsxs("div",{className:"education-skills-user-list",children:[l.jsxs("div",{className:"education-user-list",children:[l.jsx("div",{className:"education-icon",children:l.jsx(o,{})}),l.jsx("p",{className:"education-user-list-text",children:(null==(n=s.GeneralInfo)?void 0:n.Education)||"لا يوجد مكان تعليم"})]}),l.jsxs("div",{className:"skills-user-list",children:[l.jsx("div",{className:"skills-icon",children:l.jsx(d,{})}),l.jsxs("div",{className:"skills-user-list-text",children:[Array.isArray(null==(t=s.GeneralInfo)?void 0:t.skills)&&s.GeneralInfo.skills.length>0?s.GeneralInfo.skills.slice(0,3).map(((s,e)=>l.jsx("span",{className:"skill-users-list",children:s.trim()},e))):l.jsx("span",{children:"لا يوجد مهارات"}),(null==(u=null==(r=s.GeneralInfo)?void 0:r.skills)?void 0:u.length)>3&&l.jsxs("span",{className:"more-skills",children:["+",s.GeneralInfo.skills.length-3," أخرى"]})]})]})]})]}),l.jsxs("div",{className:"user-stats-home",children:[l.jsxs("div",{className:"stat-item-home",children:[l.jsx("span",{className:"stat-value-home",children:s.friendsCount||0}),l.jsx("span",{className:"stat-label-home",children:"الأصدقاء"})]}),l.jsxs("div",{className:"stat-item-home",children:[l.jsx("span",{className:"stat-value-home",children:s.projectsCount||0}),l.jsx("span",{className:"stat-label-home",children:"المشاريع"})]}),l.jsxs("div",{className:"stat-item-home",children:[l.jsx("span",{className:"stat-value-home",children:s.postsCount||0}),l.jsx("span",{className:"stat-label-home",children:"المنشورات"})]})]})]},s._id)}))})]})]}),j&&l.jsx("div",{className:"loading-spinner-user-list",children:l.jsx("div",{className:"spinner-user-list"})}),w&&l.jsx("div",{className:"loading-more-user-list",children:l.jsx("div",{className:"spinner-user-list small"})}),p&&l.jsxs("div",{className:"error-message",children:[l.jsx("p",{children:p}),l.jsx("button",{onClick:()=>L(1),children:"إعادة المحاولة"})]})]})}export{u as default};
