import{r as s,j as e,o as a,a0 as i,a1 as t,a2 as n,a3 as c,f as r,e as o}from"./index-epAGByur.js";import{m as l}from"./proxy-DCvGezJ2.js";import"./vendor-MJHYApCa.js";r.locale("ar");const d=()=>{const[d,m]=s.useState([]),[h,j]=s.useState(!0),[p,x]=s.useState(1),[u,f]=s.useState(!0),[N,v]=s.useState(!1),[g,w]=s.useState(!1),y=s.useRef();y.current={hasMore:u,loadingMore:g,page:p};const S=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});s.useEffect((()=>{(async s=>{if(!N){v(!0),1===s?j(!0):w(!0);try{const{data:e}=await o.get(`https://padel-hnj9.onrender.com/api/notifications?page=${s}&limit=20`,S()),a=e.notifications;m((s=>{const e=s.map((s=>s._id)),i=a.filter((s=>!e.includes(s._id)));return[...s,...i]})),f(e.hasMore)}catch(e){}finally{j(!1),w(!1),v(!1)}}})(p)}),[p]),s.useEffect((()=>{const s=()=>{const{scrollHeight:s,scrollTop:e,clientHeight:a}=document.documentElement,{hasMore:i,loadingMore:t}=y.current;e+a>=s-5&&i&&!t&&x((s=>s+1))};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)}),[]);return h?e.jsxs("div",{className:"loading-container-notifications",children:[e.jsx("div",{className:"spinner-notifications"}),e.jsx("p",{children:"جاري تحميل الإشعارات..."})]}):e.jsxs("div",{className:"notifications-container",children:[e.jsx(a,{}),e.jsxs("div",{className:"container",children:[e.jsxs(l.div,{className:"header",children:[e.jsx(i,{size:28,className:"bell-icon"}),e.jsx("h1",{className:"title",children:"أشعارات المستخدم"})]}),h?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"جاري تحميل الإشعارات..."})]}):0===d.length?e.jsxs(l.div,{className:"empty-state",children:[e.jsx(t,{size:48}),e.jsx("p",{children:"لا يوجد إشعارات"})]}):e.jsxs(l.div,{className:"notifications-grid",children:[d.map((s=>e.jsxs(l.div,{className:"notification-card "+(s.read?"read":""),children:[e.jsxs("div",{className:"notification-header-upper",children:[e.jsx("div",{className:"status-indicator-upper",children:!s.read&&e.jsx("div",{className:"unread-dot"})}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>(async s=>{try{await o.patch(`https://padel-hnj9.onrender.com/api/notifications/${s}/read`,{},S()),m((e=>e.map((e=>e._id===s?{...e,read:!0}:e))))}catch(e){}})(s._id),className:"action-button",title:"تعليم كمقروء",children:e.jsx(t,{})}),e.jsx("button",{onClick:()=>(async s=>{try{await o.delete(`https://padel-hnj9.onrender.com/api/notifications/${s}`,S()),m((e=>e.filter((e=>e._id!==s))))}catch(e){}})(s._id),className:"action-button",title:"حذف الإشعار",children:e.jsx(n,{})})]})]}),e.jsx("p",{className:"message",children:s.message}),e.jsxs("div",{className:"time-stamp",children:[e.jsx(c,{size:14}),e.jsx("span",{children:r(s.createdAt).fromNow()})]})]},s._id))),g&&e.jsxs("div",{className:"loading-more-notifications-more",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"جاري تحميل المزيد..."})]})]})]})]})};export{d as default};
