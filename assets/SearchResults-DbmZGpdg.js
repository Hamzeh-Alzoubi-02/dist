import{ae as s,r as e,j as a,P as r,L as l,f as c,k as t}from"./index-epAGByur.js";import"./vendor-MJHYApCa.js";c.extend(t),c.locale("ar");const i=({users:s,handleImageClick:e})=>{const c=localStorage.getItem("userId");return a.jsxs("div",{className:"search-results__users-container",children:[a.jsx("h3",{className:"search-results__section-title",children:"المستخدمون"}),a.jsx("div",{className:"search-results__users-grid",children:s.map((s=>{var t,i,n,d;return a.jsxs("div",{className:"user-card",children:[a.jsxs("div",{className:"user-card__header",children:[a.jsx("img",{onClick:()=>e(s.profileImage),src:s.profileImage||r,alt:`ملف ${s.name} الشخصي`,loading:"lazy",className:"user-card__avatar",onError:s=>s.target.src=r}),a.jsx(l,{to:c===s._id?"/@!profile":`/@!users/${s._id}`,className:"user-card__name",children:s.name})]}),a.jsxs("div",{className:"user-card__details",children:[a.jsxs("div",{className:"user-card__detail-item",children:[a.jsx("span",{className:"detail-label",children:"الدولة:"}),a.jsx("span",{className:"detail-value",children:(null==(t=s.personalInfo)?void 0:t.country)||"غير محدد"})]}),a.jsxs("div",{className:"user-card__detail-item",children:[a.jsx("span",{className:"detail-label",children:"الخبرة:"}),a.jsx("span",{className:"detail-value",children:(null==(i=s.GeneralInfo)?void 0:i.workExperience)||"غير محدد"})]}),a.jsxs("div",{className:"user-card__detail-item",children:[a.jsx("span",{className:"detail-label",children:"المهارات:"}),a.jsx("span",{className:"detail-value",children:(null==(d=null==(n=s.GeneralInfo)?void 0:n.skills)?void 0:d.join("، "))||"غير محدد"})]})]})]},s._id)}))})]})},n=({posts:s,handleImageClick:e})=>{const t=localStorage.getItem("userId");return a.jsxs("div",{className:"search-results__posts-container",children:[a.jsx("h3",{className:"search-results__section-title",children:"المنشورات"}),a.jsx("ul",{className:"search-results__posts-list",children:s.map((s=>a.jsxs("li",{className:"post-card",children:[a.jsxs("div",{className:"post-card__header",children:[a.jsx("img",{className:"post-card__avatar",src:s.userId.profileImage||r,alt:`ملف ${s.userId.name} الشخصي`,loading:"lazy",onClick:()=>e(s.userId.profileImage),onError:s=>s.target.src=r}),a.jsxs("div",{className:"post-card__user-info",children:[a.jsx(l,{to:t===s.userId._id?"/@!profile":`/@!users/${s.userId._id}`,className:"post-card__username",children:s.userId.name}),a.jsx("span",{className:"post-card__timestamp",children:c(s.createdAt).fromNow()})]})]}),a.jsxs("div",{className:"post-card__content",children:[a.jsx("p",{className:"post-card__text",children:s.text}),s.image&&a.jsx("img",{className:"post-card__image",src:s.image,loading:"lazy",alt:"محتوى المنشور",onClick:()=>e(s.image)}),a.jsx("p",{className:"post-card__link",children:s.links.map((s=>a.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:s},s)))})]}),a.jsx("div",{className:"post-card__footer",children:a.jsx(l,{to:`/post/${s._id}`,className:"post-card__link",children:"عرض صفحة المنشور"})})]},s._id)))})]})},d=({projects:s,handleImageClick:e})=>{const t=localStorage.getItem("userId");return a.jsxs("div",{className:"search-results__projects-container",children:[a.jsx("h3",{className:"search-results__section-title",children:"المشاريع"}),a.jsx("div",{className:"search-results__projects-grid",children:s.map((s=>{var i;return a.jsxs("div",{className:"project-card",children:[a.jsxs("div",{className:"project-card__header",children:[a.jsx("img",{className:"project-card__avatar",src:s.userId.profileImage||r,loading:"lazy",onClick:()=>e(s.userId.profileImage),onError:s=>s.target.src=r}),a.jsx(l,{to:t===s.userId._id?"/@!profile":`/@!users/${s.userId._id}`,className:"project-card__username",children:s.userId.name}),a.jsx("p",{className:"project-card__timestamp",children:c(s.createdAt).fromNow()})]}),a.jsxs("div",{className:"project-card__content",children:[a.jsx("h4",{className:"project-card__title",children:s.title}),a.jsx("p",{className:"project-card__description",children:s.description}),a.jsx("p",{className:"project-card__links",children:(null==s?void 0:s.link)?a.jsx("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",children:s.link}):a.jsx("div",{style:{display:"none"}})}),(null==(i=s.images)?void 0:i.length)>0&&a.jsx("div",{className:"project-card__gallery",children:s.images.slice(0,3).map(((r,l)=>a.jsx("img",{src:r,alt:`معاينة مشروع ${s.title}`,loading:"lazy",className:"project-card__image",onClick:()=>e(r)},`${s._id}-${l}`)))})]}),a.jsx("div",{className:"project-card__footer",children:a.jsx(l,{to:`/project/${s._id}`,className:"project-card__link",children:"عرض صفحة المشروع"})})]},s._id)}))})]})},o=()=>{const l=s(),c=new URLSearchParams(l.search).get("expertise"),[t,o]=e.useState({users:[],posts:[],projects:[]}),[m,j]=e.useState(!0),[h,p]=e.useState(null),[_,u]=e.useState(null),[x,g]=e.useState(1),[N,f]=e.useState(!1),[v,I]=e.useState(!0),[k,b]=e.useState("posts"),w=localStorage.getItem("token"),C=e.useRef({loadingMore:N,page:x});e.useEffect((()=>{C.current={loadingMore:N,page:x}}),[N,x]);const y=async s=>{try{1===s?j(!0):f(!0);const e=await fetch(`https://padel-hnj9.onrender.com/api/search-expertise?expertise=${encodeURIComponent(c)}&page=${s}&limit=20`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`}});if(!e.ok)throw new Error("فشل في جلب نتائج البحث");const a=await e.json();o((e=>({users:1===s?a.results:[...e.users,...a.results].filter(((s,e,a)=>a.findIndex((e=>e._id===s._id))===e)),posts:1===s?a.resultsPost:[...e.posts,...a.resultsPost].filter(((s,e,a)=>a.findIndex((e=>e._id===s._id))===e)),projects:1===s?a.resultsProject:[...e.projects,...a.resultsProject].filter(((s,e,a)=>a.findIndex((e=>e._id===s._id))===e))}))),I(a.hasMoreUsers||a.hasMorePosts||a.hasMoreProjects),p(null)}catch(e){p(e.message)}finally{j(!1),f(!1)}};e.useEffect((()=>{c&&(g(1),y(1))}),[c]),e.useEffect((()=>{const s=()=>{N||m||!v||window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&g((s=>s+1))};return window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)}),[N,m,v]),e.useEffect((()=>{1!==x&&y(x)}),[x]);const E=s=>{u(s)};return c?a.jsxs("div",{className:"search-results",children:[a.jsxs("h2",{className:"search-results__title",children:['نتائج البحث عن: "',c,'"']}),a.jsxs("div",{className:"search-results__tabs",children:[a.jsxs("button",{className:"tab-button "+("posts"===k?"active":""),onClick:()=>b("posts"),children:[a.jsx("i",{className:"fas fa-newspaper"})," المنشورات (",t.posts.length,")"]}),a.jsxs("button",{className:"tab-button "+("users"===k?"active":""),onClick:()=>b("users"),children:[a.jsx("i",{className:"fas fa-users"})," المستخدمون (",t.users.length,")"]}),a.jsxs("button",{className:"tab-button "+("projects"===k?"active":""),onClick:()=>b("projects"),children:[a.jsx("i",{className:"fas fa-project-diagram"})," المشاريع (",t.projects.length,")"]})]}),m&&a.jsxs("div",{className:"spinner-container",children:[a.jsx("div",{className:"spinner large"}),a.jsx("p",{children:"جارٍ تحميل نتائج البحث..."})]}),h&&a.jsxs("div",{className:"search-results__error",children:[a.jsx("i",{className:"fas fa-exclamation-circle"}),a.jsxs("p",{children:["خطأ: ",h]})]}),!m&&!h&&a.jsxs(a.Fragment,{children:["users"===k&&0===t.users.length&&a.jsxs("div",{className:"no-results",children:[a.jsx("i",{className:"fas fa-user-slash"}),a.jsx("p",{children:"لا يوجد مستخدمون مطابقون."})]}),"posts"===k&&0===t.posts.length&&a.jsxs("div",{className:"no-results",children:[a.jsx("i",{className:"fas fa-file-alt"}),a.jsx("p",{children:"لا يوجد منشورات مطابقة."})]}),"projects"===k&&0===t.projects.length&&a.jsxs("div",{className:"no-results",children:[a.jsx("i",{className:"fas fa-project-diagram"}),a.jsx("p",{children:"لا يوجد مشاريع مطابقة."})]}),"users"===k&&t.users.length>0&&a.jsx(i,{users:t.users,handleImageClick:E}),"posts"===k&&t.posts.length>0&&a.jsx(n,{posts:t.posts,handleImageClick:E}),"projects"===k&&t.projects.length>0&&a.jsx(d,{projects:t.projects,handleImageClick:E})]}),N&&a.jsxs("div",{className:"search-results__loading-more",children:[a.jsx("div",{className:"spinner small"}),a.jsx("p",{children:"جارٍ تحميل المزيد من النتائج..."})]}),_&&a.jsx("div",{className:"image-modal",onClick:s=>{(s.target.classList.contains("image-modal")||s.target.classList.contains("image-modal__close"))&&u(null)},children:a.jsxs("div",{className:"image-modal__content",children:[a.jsx("button",{className:"image-modal__close",children:a.jsx("i",{className:"fas fa-times"})}),a.jsx("img",{src:_,loading:"lazy",alt:"معاينة الصورة",className:"image-modal__img",onError:s=>s.target.src=r})]})})]}):a.jsx("p",{className:"search-results__message",children:"يرجى إدخال كلمة البحث في الاستعلام."})};export{o as default};
