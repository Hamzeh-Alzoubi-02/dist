import{r as e,j as s,o as c,f as t,e as a,k as r}from"./index-epAGByur.js";import"./vendor-MJHYApCa.js";t.extend(r),t.locale("ar");const l=()=>{var r;const[l,i]=e.useState([]),[n,o]=e.useState(!1),[d,p]=e.useState(null),[j,m]=e.useState(null),[u,h]=e.useState(1),[x,g]=e.useState(!0),[N,v]=e.useState(!1),b=localStorage.getItem("token"),f=e.useRef({hasMore:x,page:u});e.useEffect((()=>{f.current={hasMore:x,page:u}}),[x,u]);const y=async e=>{if(!N){v(!0);try{const s=await a.get(`https://padel-hnj9.onrender.com/api/get-public-projects?page=${e}&limit=10`,{headers:{Authorization:`Bearer ${b}`}}),c=s.data.publicProjects||[];c.length>0&&i((e=>{const s=e.map((e=>e._id)),t=c.filter((e=>!s.includes(e._id)));return[...e,...t]})),g(s.data.hasMore)}catch(s){p("حدث خطأ أثناء جلب المشاريع.")}finally{o(!1),v(!1)}}};return e.useEffect((()=>{y(1)}),[]),e.useEffect((()=>{const e=()=>{const{scrollTop:e,clientHeight:s,scrollHeight:c}=document.documentElement,{hasMore:t,page:a}=f.current;if(e+s>=c-5&&t){const e=a+1;h(e),y(e)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),n?s.jsx("div",{className:"loading-container-public",children:s.jsx("div",{className:"spinner-public-projects"})}):d?s.jsx("p",{className:"error-public",children:d}):s.jsxs("div",{className:"public-projects-container",children:[s.jsx(c,{}),s.jsxs("div",{className:"container-public-projects",children:[s.jsx("div",{className:"projects-grid-public-projects",children:0===l.length?s.jsx("p",{className:"empty-msg-public",children:"لا توجد مشاريع عامة حالياً"}):l.map((e=>s.jsxs("div",{className:"project-card-public-projects",children:[s.jsx("div",{className:"card-image-public-projects",children:e.ImgProjects?s.jsx("img",{src:e.ImgProjects,alt:e.projectName,loading:"lazy",className:"project-image-public-projects"}):s.jsx("div",{className:"placeholder-image",children:s.jsx("span",{children:"لا توجد صورة"})})}),s.jsxs("div",{className:"card-content-public-projects",children:[s.jsx("h3",{children:e.projectName||"اسم المشروع غير متوفر"}),s.jsx("p",{className:"project-time",children:t(e.createdAt).fromNow()}),s.jsx("button",{onClick:()=>m(e),children:"عرض التفاصيل"})]})]},e._id)))}),j&&s.jsx("div",{className:"modal-overlay-public",onClick:()=>m(null),children:s.jsxs("div",{className:"modal-content-public",onClick:e=>e.stopPropagation(),children:[s.jsx("span",{className:"close-btn-public",onClick:()=>m(null),children:"×"}),s.jsx("h2",{children:j.projectName}),s.jsx("p",{children:"string"==typeof j.projectDescription?j.projectDescription:"لا يوجد وصف متاح."}),s.jsxs("div",{className:"project-details-extra",children:[s.jsxs("p",{children:["عدد الأعضاء: ",(null==(r=j.members)?void 0:r.length)||0]}),s.jsxs("p",{children:["تاريخ الإنشاء: ","Invalid date"===t(j.createdAt).format("DD/MM/YYYY")?"لا يوجد تاريخ متاح.":t(j.createdAt).format("DD/MM/YYYY")]})]}),s.jsx("img",{src:j.ImgProjects,alt:j.projectName,loading:"lazy"}),s.jsx("a",{className:"view-link-public",href:`/projectJoint/${j._id}`,children:"زيارة صفحة المشروع"})]})})]})]})};export{l as default};
