import{r as e,j as t,l as r,e as s,P as a,L as c,f as o,k as n,o as l,m as i}from"./index-epAGByur.js";import{s as d}from"./message-BbX-ItwN.js";import{M as m}from"./index-EzTomcpk.js";import"./vendor-MJHYApCa.js";const p=({projectId:s})=>{const[a,c]=e.useState(!1),o=(e=>`${window.location.origin}/project/${e}`)(s);return t.jsx("div",{className:"share-button-container-project",children:t.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(o),c(!0),setTimeout((()=>c(!1)),2e3)}catch{c(!0),setTimeout((()=>c(!1)),2e3)}},className:"share-button-project",title:"انسخ الرابط",children:a?"تم نسخ الرابط!":t.jsx(r,{className:"share-icon-project"})})})};o.extend(n),o.locale("ar");const j=({projectId:r})=>{const[n,l]=e.useState(!1),[i,p]=e.useState({}),[j,u]=e.useState("comments"),[h,x]=e.useState([]),[g,N]=e.useState([]),[v,f]=e.useState(""),[y,I]=e.useState({}),[k,_]=e.useState({}),b=localStorage.getItem("userId"),P=()=>l(!1),[S,G]=e.useState(1),[$,w]=e.useState(!0),[C,z]=e.useState(!1),A=e.useRef({hasMore:$,loadingMore:C,page:S});e.useEffect((()=>{A.current={hasMore:$,loadingMore:C,page:S}}),[$,C,S]);const M=async e=>{try{z(!0);const t=localStorage.getItem("token"),a=await s.get(`https://padel-hnj9.onrender.com/api/commentsAndLikes/${r}?page=${e}&limit=5`,{headers:{Authorization:`Bearer ${t}`}});N(a.data.likes);const c=a.data.comments;c.length>0&&x((e=>{const t=new Set(e.map((e=>e._id))),r=c.filter((e=>!t.has(e._id)));return[...e,...r]})),w(a.data.hasMore)}catch(t){}finally{z(!1)}};e.useEffect((()=>{n&&M(1)}),[n,r]);return t.jsxs("div",{className:"comments-section-container-project",children:[t.jsx("button",{className:"open-comments-btn-project-user",onClick:()=>l(!0),children:t.jsx("span",{className:"comment-icon-project-user",children:"💬"})}),t.jsxs(m,{isOpen:n,onRequestClose:P,className:"comments-modal-container-project-user",overlayClassName:"modal-overlay-project-user",ariaHideApp:!1,children:[t.jsx("div",{className:"modal-header-container-project-user-project",children:t.jsxs("div",{className:"modal-header-project-user",children:[t.jsx("p",{className:"tab-title-project-user",children:"comments"===j?"التعليقات":"الإعجابات"}),t.jsx("button",{className:"close-modal-btn-project-user",onClick:P,"aria-label":"إغلاق",children:"×"})]})}),t.jsx("div",{}),t.jsxs("div",{className:"tabs-container-project-user",children:[t.jsxs("button",{className:"tab-btn-project-user "+("comments"===j?"active":""),onClick:()=>u("comments"),children:["التعليقات (",h.length,")"]}),t.jsxs("button",{className:"tab-btn-project-user "+("likes"===j?"active":""),onClick:()=>u("likes"),children:["الإعجابات (",g.length,")"]})]}),t.jsx("div",{className:"modal-content-container-project",children:"comments"===j?t.jsxs(t.Fragment,{children:[t.jsx("form",{className:"comment-input-wrapper-project-user",onSubmit:async e=>{if(e.preventDefault(),v.trim())try{const e=localStorage.getItem("token"),t=(await s.post("https://padel-hnj9.onrender.com/api/comment",{projectId:r,comment:v},{headers:{Authorization:`Bearer ${e}`}})).data.comment;x((e=>[...e,t])),f("")}catch(t){}},children:t.jsxs("div",{className:"comment-input-container-project-user",children:[t.jsx("input",{type:"text",value:v,onChange:e=>f(e.target.value),placeholder:"اكتب تعليقك هنا...",className:"comment-input-project-user-project"}),t.jsx("button",{type:"submit",className:"send-comment-btn-project-user-project",disabled:!v.trim(),children:t.jsx("img",{src:d,alt:"إرسال",loading:"lazy",className:"send-icon-comment-project"})})]})}),t.jsx("div",{className:"comments-list-container-project",children:h.length>0?h.map((e=>{var n,l,i,m,p,j;return t.jsxs("div",{className:"comment-container-comment-project-user",children:[t.jsxs("div",{className:"comment-header-container-project-user",children:[t.jsx("img",{src:(null==(l=null==(n=e.userId)?void 0:n.profileImage)?void 0:l.startsWith("http"))?e.userId.profileImage:`https://padel-hnj9.onrender.com${null==(i=e.userId)?void 0:i.profileImage}`,alt:"Profile",className:"comment-avatar-project-user-project",loading:"lazy",onError:e=>e.target.src=a}),t.jsx(c,{className:"comment-username-project-user-project-link",to:b===e.userId._id?"/@!profile":`/@!users/${e.userId._id}`,children:null==(m=e.userId)?void 0:m.name})]}),t.jsxs("div",{className:"comment-body-container-project-user-project",children:[t.jsx("p",{className:"comment-text-project-user-project",children:e.text}),t.jsxs("div",{className:"comment-footer-container-project-user-date",children:[(null==e?void 0:e.createdAt)&&t.jsx("p",{children:o(e.createdAt).fromNow()}),t.jsx("button",{className:"reply-toggle-btn-project-user-project",onClick:()=>_((t=>({...t,[e._id]:!t[e._id]}))),children:k[e._id]?"إخفاء الردود":"عرض الردود"}),b===e.userId._id&&t.jsx("button",{className:"delete-comment-btn-project-user-project",onClick:()=>(async e=>{try{const t=localStorage.getItem("token");await s.delete(`https://padel-hnj9.onrender.com/api/delete-comment/${e}/${r}`,{headers:{Authorization:`Bearer ${t}`}}),x((t=>t.filter((t=>t._id!==e))))}catch(t){}})(e._id),children:"حذف التعليق"})]})]}),k[e._id]&&t.jsxs("div",{className:"replies-section-container-project-user",children:[t.jsx("div",{className:"replies-list-container-project-user",children:null==(p=e.replies)?void 0:p.map((n=>{var l,i,d,m;return t.jsxs("div",{className:"reply-container-project-user-project",children:[t.jsxs("div",{className:"reply-header-container-project",children:[t.jsx("img",{src:(null==(i=null==(l=n.userId)?void 0:l.profileImage)?void 0:i.startsWith("http"))?n.userId.profileImage:`https://padel-hnj9.onrender.com${null==(d=n.userId)?void 0:d.profileImage}`,loading:"lazy",alt:"Profile",className:"reply-avatar-project-user-project",onError:e=>e.target.src=a}),t.jsx(c,{className:"reply-username-project-user-project-link",to:b===n.userId._id?"/@!profile":`/@!users/${n.userId._id}`,children:null==(m=n.userId)?void 0:m.name})]}),t.jsx("p",{className:"reply-text-project-user-project",children:n.text}),t.jsxs("div",{className:"reply-content-container-project-user-project",children:[(null==n?void 0:n.createdAt)&&t.jsx("p",{children:o(n.createdAt).fromNow()}),b===n.userId._id&&t.jsx("div",{className:"reply-edit-delete-container-project-user-project",children:t.jsx("button",{className:"delete-reply-btn-project-user-project",onClick:()=>(async(e,t)=>{try{const a=localStorage.getItem("token");await s.delete(`https://padel-hnj9.onrender.com/api/delete-reply/${e}/${t}/${r}`,{headers:{Authorization:`Bearer ${a}`}}),x((r=>r.map((r=>r._id===t?{...r,replies:r.replies.filter((t=>t._id!==e))}:r))))}catch(a){}})(n._id,e._id),children:"حذف الرد"})})]})]},n._id)}))}),t.jsx("div",{className:"reply-input-container-project-user-project",children:t.jsxs("div",{className:"reply-input-wrapper-project-user-project",children:[t.jsx("input",{type:"text",value:y[e._id]||"",onChange:t=>I((r=>({...r,[e._id]:t.target.value}))),placeholder:"اكتب ردك هنا...",className:"reply-input-project"}),t.jsx("button",{onClick:t=>(async(e,t)=>{if(t.preventDefault(),y[e]&&y[e].trim())try{const t=localStorage.getItem("token"),a=await s.post("https://padel-hnj9.onrender.com/api/reply-comment",{projectId:r,commentId:e,reply:y[e]},{headers:{Authorization:`Bearer ${t}`}});if(a.data.error)return;const c=a.data.reply;x((t=>t.map((t=>t._id===e?{...t,replies:[...t.replies,c]}:t)))),I((t=>({...t,[e]:""})))}catch(a){}})(e._id,t),className:"send-reply-inside-input-btn-project-user-project",disabled:!(null==(j=y[e._id])?void 0:j.trim()),children:t.jsx("img",{src:d,alt:"إرسال",loading:"lazy",className:"send-icon-reply-project-user-project"})})]})})]})]},e._id)})):t.jsx("p",{className:"no-comments-project-user",children:"لا توجد تعليقات بعد"})})]}):t.jsx("div",{className:"likes-section-container-project-user",children:g.length>0?t.jsx("div",{className:"likes-list-container-project-user",children:g.map((e=>{var r;return t.jsxs("div",{className:"like-item-container-project",children:[t.jsx("img",{src:(null==(r=e.profileImage)?void 0:r.startsWith("http"))?e.profileImage:`https://padel-hnj9.onrender.com${e.profileImage}`,alt:"Profile",loading:"lazy",className:"like-avatar-project-user-project",onError:e=>e.target.src=a}),t.jsx(c,{className:"like-username-project-user-project-link",to:b===e._id?"/@!profile":`/@!users/${e._id}`,children:e.name})]},e._id)}))}):t.jsx("p",{className:"no-likes",children:"لا يوجد إعجابات بعد"})})}),$&&"comments"===j&&t.jsx("div",{className:"load-more-comments-container-project",children:t.jsx("button",{className:"load-more-comments-btn-project",onClick:()=>{const e=S+1;G(e),M(e)},disabled:C,children:C?"جاري التحميل...":"عرض المزيد من التعليقات"})})]})]})};function u(){const[r,n]=e.useState([]),[d,m]=e.useState({}),[u,h]=e.useState(!0),[x,g]=e.useState(!1),[N,v]=e.useState(null),[f,y]=e.useState(1),[I,k]=e.useState(!0),[_,b]=e.useState(null),P=localStorage.getItem("userId"),S=localStorage.getItem("token"),G=e.useRef({page:f,hasMore:I,loadingMore:x});e.useEffect((()=>{G.current={page:f,hasMore:I,loadingMore:x}}),[f,I,x]);const $=e.useCallback((async e=>{try{if(!S)return void v("رمز التوثيق غير موجود");g(!0);const t=await s.get(`https://padel-hnj9.onrender.com/api/get-projects?page=${e}&limit=5`,{headers:{Authorization:`Bearer ${S}`}}),r=t.data.projects||[];m((e=>({...e,...r.reduce(((e,t)=>(e[t._id]=t.isLikedByCurrentUser,e)),{})}))),n((e=>{const t=e.map((e=>e._id)),s=r.filter((e=>!t.includes(e._id)));return[...e,...s]})),k(t.data.hasMore)}catch(t){v(`فشل في جلب المشاريع: ${t.message}`)}finally{h(!1),g(!1)}}),[S]);e.useEffect((()=>{$(1)}),[$]),e.useEffect((()=>{const e=()=>{const{scrollTop:e,clientHeight:t,scrollHeight:r}=document.documentElement,{hasMore:s,loadingMore:a,page:c}=G.current;if(e+t>=r-300&&s&&!a){const e=c+1;y(e),$(e)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[$]);return u?t.jsxs("div",{className:"loading-container-Get-Project",children:[t.jsx("div",{className:"spinner-Get-Project"}),t.jsx("p",{className:"loading-text-Get-Project",children:"جاري تحميل المشاريع..."})]}):N?t.jsx("p",{children:N}):r.length?t.jsxs("div",{className:"projects-container-Get-Project",children:[t.jsx(l,{}),t.jsx("div",{className:"projects-list-Get-Project",children:r.map((e=>{var r;return t.jsxs("div",{className:"project-card-Get-Project",children:[t.jsx("div",{className:"project-header-Get-Project",children:t.jsxs("div",{className:"project-user-Get-Project",children:[t.jsx("img",{loading:"lazy",src:e.userId.profileImage||a,alt:e.userId.name,onError:e=>{e.target.src=a}}),t.jsxs("div",{className:"project-user-info-Get-Project-home",children:[t.jsx(c,{to:e.userId._id===P?"/@!profile":`/@!users/${e.userId._id}`,className:"project-username-Get-Project",children:t.jsx("p",{children:e.userId.name})}),t.jsxs("p",{className:"project-date-Get-Project",children:["تم النشر: ",o(e.createdAt).fromNow()]})]})]})}),t.jsxs("div",{className:"project-details-Get-Project",children:[t.jsx("h2",{className:"project-title-Get-Project",children:e.title}),t.jsx("p",{className:"project-description-Get-Project",children:e.description}),t.jsxs("p",{className:"project-description-Get-Project",children:[t.jsx("i",{className:"fas fa-link",id:"link-icon-Get-Project"}),t.jsx("a",{className:"project-link-Get-Project",href:e.link,target:"_blank",rel:"noopener noreferrer",children:e.link})]}),(null==(r=e.images)?void 0:r.length)>0&&t.jsx("div",{className:"project-images-Get-Project",children:e.images.map(((e,r)=>t.jsx("img",{loading:"lazy",src:e,alt:`Project Image ${r}`,className:"project-image-Get-Project",onClick:()=>{b(e)}},r)))})]}),_&&t.jsxs("div",{id:"modal",className:"modal-Get-Project",children:[t.jsx("span",{className:"close-Get-Project",onClick:()=>{b(!1)},children:"×"}),t.jsx("img",{src:_,loading:"lazy",alt:"Project Image",className:"modal-content-Get-Project"})]}),t.jsxs("div",{className:"like-section-Get-Project",children:[t.jsx("div",{className:"like-button-Get-Project",onClick:t=>(async(e,t)=>{t.stopPropagation();try{const t=await s.put("https://padel-hnj9.onrender.com/api/like",{projectId:e},{headers:{Authorization:`Bearer ${S}`}});m((t=>({...t,[e]:!t[e]}))),n((r=>r.map((r=>r._id===e?{...r,likes:t.data.likes}:r))))}catch(r){}})(e._id,t),children:t.jsx(i,{size:20,color:d[e._id]?"red":"#ccc"})}),t.jsx("div",{className:"comment-section-Get-Project",children:t.jsx(j,{projectId:e._id})}),t.jsx("div",{className:"share-button-Get-Project",children:t.jsx(p,{projectId:e._id})})]})]},e._id)}))}),x&&t.jsxs("div",{className:"loading-placeholder-Get-Project",children:[t.jsx("span",{className:"spinner-placeholder-Get-Project"}),"جاري تحميل المزيد..."]})]}):t.jsx("p",{className:"no-projects-Get-Project",children:"لا يوجد مشاريع معتمدة"})}o.extend(n),o.locale("ar");export{u as default};
