import{r as e,j as t,aj as a,ab as s,aa as n,P as i,f as c,ac as l,L as r,e as o,k as d}from"./index-epAGByur.js";import"./vendor-MJHYApCa.js";function j(){const[d,j]=e.useState([]),[m,p]=e.useState(""),[u,h]=e.useState(""),[g,x]=e.useState(""),[N,v]=e.useState(null),[f,y]=e.useState(null),[b,S]=e.useState(!1),[w,k]=e.useState(""),[E,P]=e.useState(""),[C,_]=e.useState(!1),[z,$]=e.useState(""),[M,I]=e.useState(null),[L,A]=e.useState(1),[T,B]=e.useState(!0),[R,D]=e.useState(!1),[F,H]=e.useState(null),U=e.useRef({hasMore:T,loadingMore:R,page:L});e.useEffect((()=>{U.current={hasMore:T,loadingMore:R,page:L}}),[T,R,L]);const O=async e=>{try{const t=localStorage.getItem("token"),{data:a}=await o.get(`https://padel-hnj9.onrender.com/api/get-project-user?page=${e}&limit=5`,{headers:{Authorization:`Bearer ${t}`}}),s=a.projects;s.length>0&&j((e=>{const t=new Set(e.map((e=>e._id))),a=s.filter((e=>!t.has(e._id)));return[...e,...a]})),B(a.hasMore),D(!1)}catch(t){}finally{S(!1)}};e.useEffect((()=>{O(1)}),[]),e.useEffect((()=>{const e=()=>{const{scrollTop:e,scrollHeight:t,clientHeight:a}=document.documentElement,{hasMore:s,loadingMore:n,page:i}=U.current;if(e+a>=t-10&&s&&!n){const e=i+1;A(e),O(e)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),e.useEffect((()=>{if(w||E){const e=setTimeout((()=>{k(""),P("")}),3e3);return()=>clearTimeout(e)}}),[w,E]);const q=e=>v(e.target.files[0]),G=e=>{e.preventDefault(),N&&N.size>5242880||($("edit"),_(!0))},J=async e=>{_(!1),e&&("delete"===z?await K(M):"edit"===z&&await Q())},K=async e=>{var t,a;try{const t=localStorage.getItem("token");await o.delete(`https://padel-hnj9.onrender.com/api/delete-project/${e}`,{headers:{Authorization:`Bearer ${t}`}}),P("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­"),j((t=>t.filter((t=>t._id!==e))))}catch(s){null==(a=null==(t=s.response)?void 0:t.data)||a.message}},Q=async()=>{var e,t;S(!0);try{const e=new FormData;e.append("title",m),e.append("description",u),e.append("link",g),N&&e.append("image",N);const t=localStorage.getItem("token");await o.put(`https://padel-hnj9.onrender.com/api/edit-project/${f}`,e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}}),V(),k("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø¬Ø§Ø­"),j([]),O(1)}catch(a){null==(t=null==(e=a.response)?void 0:e.data)||t.message}finally{S(!1),H(null)}},V=()=>{y(null),p(""),h(""),x(""),v(null)};return b?t.jsx("div",{className:"loading-container-EditProject"}):t.jsx("div",{className:"EditProject",children:t.jsxs("div",{className:"edit-project-container",children:[t.jsx("h1",{className:"edit-project-title",children:"Ù…Ø´Ø§Ø±ÙŠØ¹ÙŠ"}),w&&t.jsx("div",{className:"edit-success-message-EditProject",children:w}),E&&t.jsx("div",{className:"delete-success-message-EditProject",children:E}),0===d.length?t.jsxs("div",{className:"no-projects",children:[t.jsx(a,{className:"no-projects-icon"}),t.jsx("p",{children:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹"})]}):t.jsx("div",{className:"projects-grid",children:d.map((e=>{var a,o;return t.jsx("div",{className:"project-card",children:F===e._id?t.jsxs("div",{className:"edit-project-card-form",children:["Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",t.jsx("input",{type:"text",value:m,onChange:e=>p(e.target.value),className:"edit-project-input"}),"ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",t.jsx("textarea",{value:u,onChange:e=>h(e.target.value),className:"edit-project-textarea"}),"Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",t.jsx("input",{type:"url",value:g,onChange:e=>x(e.target.value),className:"edit-project-input"}),t.jsx("div",{className:"existing-images",children:N?t.jsxs("div",{className:"new-image-wrapper",children:[t.jsx("img",{src:URL.createObjectURL(N),alt:"New Preview",loading:"lazy",className:"existing-image new-image"}),t.jsx("span",{className:"new-image-label",children:"ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©"})]}):null==(a=e.images)?void 0:a.map(((e,a)=>t.jsx("img",{src:e,loading:"lazy",alt:`Project ${a+1}`,className:"existing-image"},a)))}),t.jsxs("label",{children:[t.jsx("input",{type:"file",onChange:q,className:"edit-project-input-file",style:{display:"none"}}),t.jsx(s,{className:"edit-project-input-icon"})]}),t.jsxs("div",{className:"project-actions",children:[t.jsx("button",{onClick:G,className:"project-action-btn",children:"Ø­ÙØ¸"}),t.jsxs("button",{className:"project-action-btn-delete",onClick:()=>{return t=e._id,$("delete"),I(t),void _(!0);var t},children:[t.jsx(n,{className:"project-action-icon-delete-icon"}),"Ø­Ø°Ù"]}),t.jsx("button",{onClick:()=>H(null),className:"project-action-btn-cancel",children:"Ø¥Ù„ØºØ§Ø¡"})]})]}):t.jsxs(t.Fragment,{children:[(null==(o=e.images)?void 0:o.length)>0&&t.jsxs("div",{children:[t.jsxs("div",{className:"project-Personal-image-container",children:[t.jsx("img",{src:e.userId.profileImage||i,onError:e=>e.target.src=i,alt:"Project",className:"project-Personal-image",loading:"lazy"}),t.jsx("p",{children:e.userId.name}),t.jsx("span",{children:c(e.createdAt).fromNow()})]}),t.jsxs("div",{className:"project-image",children:[t.jsx("img",{src:e.images,alt:"Project",loading:"lazy",className:"project-image-img"}),t.jsxs("div",{className:"project-image-count",children:[t.jsx(s,{className:"project-image-icon"}),e.images.length," ØµÙˆØ±"]})]})]}),t.jsx("h2",{className:"project-title",children:e.title}),t.jsx("p",{className:"project-description",children:e.description}),t.jsx("a",{href:e.link,target:"_blank",className:"project-link-container-edit",children:e.link}),t.jsxs("div",{className:"project-actions",children:[t.jsxs("button",{className:"project-action-btn",onClick:()=>(e=>{const t=d.find((t=>t._id===e));y(e),p(t.title),h(t.description),x(t.link),H(e)})(e._id),children:[t.jsx(l,{className:"project-action-icon"}),"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"]}),t.jsx("button",{className:"project-action-btn",children:t.jsx(r,{to:`/project/${e._id}`,className:"project-action-link",children:"ðŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"})})]})]})},e._id)}))}),C&&t.jsx("div",{className:"confirm-modal-overlay-EditProject",children:t.jsxs("div",{className:"confirm-modal-content-EditProject",children:[t.jsxs("p",{children:["Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ","delete"===z?"Ø­Ø°Ù":"ØªØ¹Ø¯ÙŠÙ„"," Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ"]}),t.jsxs("div",{className:"confirm-modal-buttons-EditProject",children:[t.jsx("button",{onClick:()=>J(!0),className:"confirm-btn-yes",children:"Ù†Ø¹Ù…"}),t.jsx("button",{onClick:()=>J(!1),className:"confirm-btn-no",children:"Ù„Ø§"})]})]})})]})})}c.locale("ar"),c.extend(d);export{j as default};
