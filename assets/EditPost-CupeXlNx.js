import{r as e,j as s,n as t,aa as a,P as i,f as n,ab as l,ac as o,L as d,e as r,k as c}from"./index-epAGByur.js";import"./vendor-MJHYApCa.js";function m(){const[c,m]=e.useState([]),[u,h]=e.useState(null),[x,j]=e.useState(""),[g,p]=e.useState(null),[N,v]=e.useState(""),[E,P]=e.useState(null),[f,b]=e.useState(""),[y,S]=e.useState(!1),[k,_]=e.useState(null),[w,C]=e.useState(null),[I,z]=e.useState(1),[$,L]=e.useState(!0),[A,T]=e.useState(!1),[B,H]=e.useState({}),[R,U]=e.useState(!0),D=async e=>{try{const s=localStorage.getItem("token"),t=await r.get(`https://padel-hnj9.onrender.com/api/get-posts-by-user?page=${e}&limit=5`,{headers:{Authorization:`Bearer ${s}`}}),a=t.data.posts;a.length>0&&m((e=>{const s=new Set(e.map((e=>e._id))),t=a.filter((e=>!s.has(e._id)));return[...e,...t]})),L(t.data.hasMore)}catch(s){}finally{U(!1),T(!1)}};e.useEffect((()=>{D(1)}),[]),e.useEffect((()=>{const e=()=>{const{scrollTop:e,scrollHeight:s,clientHeight:t}=document.documentElement;if(e+t>=s-10&&$&&!A){const e=I+1;z(e),T(!0),D(e)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[$,A,I]),e.useEffect((()=>{if(N||E){const e=setTimeout((()=>{v(""),P(null)}),3e3);return()=>clearTimeout(e)}}),[N,E]);const F=e=>j(e.target.value),M=e=>p(e.target.files[0]),O=(e,s)=>{_(e),C(s),S(!0)},q=async()=>{"save"===k?await G(w):"delete"===k&&await J(w),S(!1),_(null),C(null)},G=async e=>{var s,t,a,i;try{const a=localStorage.getItem("token"),i=new FormData;if(i.append("text",x),g&&i.append("image",g),!x.trim()&&!g&&!(null==(s=c.find((s=>s._id===e)))?void 0:s.image))return void b("يرجى إدخال نص أو إرفاق صورة");null===g&&(null==(t=c.find((s=>s._id===e)))?void 0:t.image)&&i.append("removeImage","true");const n=await r.put(`https://padel-hnj9.onrender.com/api/postusers/${e}`,i,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}});m((s=>s.map((s=>s._id===e?n.data.post:s)))),K(),v("تم التعديل بنجاح")}catch(n){b((null==(i=null==(a=n.response)?void 0:a.data)?void 0:i.message)||"فشل تعديل المنشور")}},J=async e=>{try{const s=localStorage.getItem("token");await r.delete(`https://padel-hnj9.onrender.com/api/postusers/${e}`,{headers:{Authorization:`Bearer ${s}`}}),m((s=>s.filter((s=>s._id!==e)))),P("تم الحذف بنجاح"),K()}catch(s){b("فشل حذف المنشور")}},K=()=>{h(null),j(""),p(null),H({})};if(R)return s.jsx("div",{className:"loading-container-edit-post",children:s.jsx("div",{className:"spinner-edit-post"})});const Q=()=>s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal",children:[s.jsxs("h3",{children:["هل أنت متأكد من"," ","save"===k?"حفظ التغييرات؟":"حذف المنشور؟"]}),s.jsxs("div",{className:"modal-buttons",children:[s.jsx("button",{className:"confirm",onClick:q,children:"نعم"}),s.jsx("button",{className:"cancel",onClick:()=>S(!1),children:"لا"})]})]})});return s.jsxs("div",{className:"container-edit",children:[s.jsx("div",{className:"EditPost-container",children:s.jsxs("div",{className:"EditPost-container-inner",children:[s.jsx("h1",{className:"EditPost-title",children:"منشوراتي "}),c.length>0?s.jsxs("div",{className:"EditPost-posts",children:[c.map((e=>s.jsx("div",{className:"EditPost-post",children:u===e._id?s.jsxs("div",{children:[s.jsxs("div",{className:"EditPost-textarea-container",children:[s.jsx("textarea",{className:"EditPost-textarea",value:x,onChange:F,placeholder:"محتوى المنشور الجديد",maxLength:500}),s.jsxs("span",{className:"EditPost-textarea-length",children:[x.length,"/500"]})]}),e.image&&!g&&!B[e._id]&&s.jsx("img",{src:e.image,alt:"Current",loading:"lazy",className:"EditPost-current-image"}),g&&s.jsx("img",{src:URL.createObjectURL(g),alt:"Preview",loading:"lazy",className:"EditPost-current-image"}),f&&s.jsx("p",{style:{color:"red"},className:"EditPost-error",children:f}),s.jsx("div",{children:s.jsxs("label",{className:"EditPost-image-label",children:[s.jsx("input",{type:"file",onChange:M,style:{display:"none"}}),s.jsx(t,{className:"EditPost-image-icon"}),"تحميل صورة"]})}),(e.image||g)&&s.jsxs("button",{className:"EditPost-button-delete-image",onClick:()=>{p(null),H((s=>({...s,[e._id]:!0})))},children:[s.jsx(a,{className:"EditPost-image-icon-delete-image"})," حذف الصورة"]}),s.jsxs("div",{className:"EditPost-buttons",children:[s.jsx("button",{className:"EditPost-button-save",onClick:()=>O("save",e._id),children:"حفظ التغييرات"}),s.jsxs("button",{className:"EditPost-button-delete",onClick:()=>O("delete",e._id),children:[s.jsx(a,{})," حذف المنشور"]}),s.jsx("button",{className:"EditPost-button-cancel",onClick:K,children:"الغاء"})]})]}):s.jsxs("div",{children:[s.jsx("div",{className:"EditPost-info-user-container",children:s.jsxs("div",{className:"EditPost-info-user",children:[s.jsx("img",{src:e.userId.profileImage||i,alt:"Profile",loading:"lazy",className:"EditPost-info-user-image",onError:e=>e.target.src=i}),s.jsxs("div",{className:"EditPost-info-user-details-container-edit",children:[s.jsx("span",{className:"EditPost-info-user-name",children:e.userId.name}),s.jsx("span",{className:"EditPost-info-user-username",children:n(e.createdAt).fromNow()})]})]})}),s.jsx("p",{className:"EditPost-text",children:e.text}),e.image&&s.jsxs("div",{className:"EditPost-image-container",children:[s.jsx("img",{src:e.image,alt:e.text,className:"EditPost-image",loading:"lazy"}),s.jsxs("div",{className:"EditPost-image-overlay",children:[s.jsx(l,{className:"EditPost-image-icon"}),"Image"]})]}),(null==e?void 0:e.links)&&s.jsx("a",{href:e.links,target:"_blank",rel:"noopener noreferrer",children:s.jsx("p",{className:"EditPost-link",children:e.links})}),s.jsxs("div",{className:"EditPost-buttons",children:[s.jsxs("button",{className:"EditPost-button-edit",onClick:()=>{h(e._id),j(e.text||"")},children:[s.jsx(o,{})," تعديل"]}),s.jsx(d,{to:`/post/${e._id}`,children:s.jsx("button",{className:"EditPost-button-view",children:"👁️ عرض المنشور"})})]})]})},e._id))),A&&s.jsx("p",{className:"loading-more",children:"جاري تحميل المزيد..."})]}):s.jsx("p",{children:"لا يوجد منشورات"}),N&&s.jsx("p",{className:"EditPost-success",children:N}),E&&s.jsx("div",{className:"EditPost-success",children:s.jsx("p",{children:E})})]})}),y&&s.jsx(Q,{})]})}n.locale("ar"),n.extend(c);export{m as default};
